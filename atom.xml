<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Hexo</title>
  
  
  <link href="https://blog.ahao.space/atom.xml" rel="self"/>
  
  <link href="https://blog.ahao.space/"/>
  <updated>2024-04-23T14:27:23.078Z</updated>
  <id>https://blog.ahao.space/</id>
  
  <author>
    <name>Ahao</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>如何解决npm install卡在“sill idealTree buildDeps“的问题</title>
    <link href="https://blog.ahao.space/2024/04/23/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3npm_install%E5%8D%A1%E5%9C%A8%E2%80%9Csill-idealTree-buildDeps%E2%80%9C%E7%9A%84%E9%97%AE%E9%A2%98/"/>
    <id>https://blog.ahao.space/2024/04/23/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3npm_install%E5%8D%A1%E5%9C%A8%E2%80%9Csill-idealTree-buildDeps%E2%80%9C%E7%9A%84%E9%97%AE%E9%A2%98/</id>
    <published>2024-04-23T14:22:40.000Z</published>
    <updated>2024-04-23T14:27:23.078Z</updated>
    
    <content type="html"><![CDATA[<h1 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h1><blockquote><p>运行<code>npm install</code> 命令后，卡在<code>idealTree:xxx: sill idealTree buildDeps</code>很长时间后报错：</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#npm install -g npm</span></span><br><span class="line">npm ERR! code UNABLE_TO_VERIFY_LEAF_SIGNATURE</span><br><span class="line">npm ERR! errno UNABLE_TO_VERIFY_LEAF_SIGNATURE</span><br><span class="line">npm ERR! request to https://registry.npmjs.org/npm failed, reason: unable to verify the first certificate</span><br><span class="line"></span><br><span class="line">npm ERR! A complete <span class="built_in">log</span> of this run can be found <span class="keyword">in</span>: C:\...\xx.log</span><br></pre></td></tr></table></figure><h1 id="可优先尝试的其他方法"><a href="#可优先尝试的其他方法" class="headerlink" title="可优先尝试的其他方法"></a>可优先尝试的其他方法</h1><p>以下方法可修复大部分问题</p><ol><li><p>删除用户界面下的<code>.npmrc</code>文件（注意一定是用户C:\Users{账户}\下的.npmrc文件下不是nodejs里面）</p></li><li><p>清除缓存： 注意 <u>不建议</u> 用<code>npm cache clean --force</code>，原因见<a href="https://developer.baidu.com/article/detail.html?id=2884682">此处</a><br>可使用：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm cache verify</span><br></pre></td></tr></table></figure></li><li><p>设置官方镜像源，并查看下是否设置成功：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npmjs.org</span><br><span class="line">npm config get registry</span><br></pre></td></tr></table></figure></li><li><p>运行npm install 安装即可</p></li><li><p>如仍未解决，可能是”网络”问题，可尝试修改为国内淘宝镜像源：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npmmirror.com</span><br><span class="line">npm config get registry</span><br></pre></td></tr></table></figure></li><li><p>修改镜像源后，重新尝试执行第四步</p></li></ol><ul><li>注：早在 2021 年，淘宝就发布了消息称，npm 淘宝镜像已经从 <code>registry.npm.taobao.org</code> 切换到了 <code>registry.npmmirror.com</code>。然而，旧域名于 2022 年 5 月 31 日停止服务，不过直到今年(2024)二月份 HTTPS 证书到期才真正不能用了。</li><li>所有如果使用了旧的淘宝镜像源也会卡在<code>sill idealTree buildDeps</code>,随后报错<strong>reason: certificate has expired</strong></li></ul><h1 id="我的问题修复"><a href="#我的问题修复" class="headerlink" title="我的问题修复"></a>我的问题修复</h1><p><a href="https://rahul-shenoy.medium.com/unable-to-verify-leaf-signature-dadaba691f0b">此方法参考文章</a></p><ul><li>浏览器访问 <a href="https://registry.npmjs.org/npm">https://registry.npmjs.org/npm</a></li><li>下载PEM证书（以Firefox浏览器为例）</li><li>npm 设置 cafile (信任证书)</li><li>修复完成–个人判断为cloudflare证书验证问题</li></ul><blockquote><p>具体步骤见以下图组</p></blockquote><p><img src="/2024/04/23/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3npm_install%E5%8D%A1%E5%9C%A8%E2%80%9Csill-idealTree-buildDeps%E2%80%9C%E7%9A%84%E9%97%AE%E9%A2%98/image-202404232130079.png"><br><img src="/2024/04/23/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3npm_install%E5%8D%A1%E5%9C%A8%E2%80%9Csill-idealTree-buildDeps%E2%80%9C%E7%9A%84%E9%97%AE%E9%A2%98/image-202404232130252.png"><br><img src="/2024/04/23/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3npm_install%E5%8D%A1%E5%9C%A8%E2%80%9Csill-idealTree-buildDeps%E2%80%9C%E7%9A%84%E9%97%AE%E9%A2%98/image-202404232131106.png"><br>在新标签页中找到PEM证书下载，<br><img src="/2024/04/23/%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3npm_install%E5%8D%A1%E5%9C%A8%E2%80%9Csill-idealTree-buildDeps%E2%80%9C%E7%9A%84%E9%97%AE%E9%A2%98/image-202404232132468.png"></p><p>下载完成后，右键文件，选择“复制文件地址”，随后在终端中设置npm信任此证书<br>指定PEM文件可直接粘贴上文复制的文件地址。</p>   <figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> npm config <span class="built_in">set</span> cafile /path/to/&lt;certname&gt;.pem</span><br></pre></td></tr></table></figure><ul><li>修复完成，可尝试重新npm install</li></ul><h1 id="最后的手段"><a href="#最后的手段" class="headerlink" title="最后的手段"></a>最后的手段</h1><ul><li>出于安全考虑，极不推荐，但个别csdn文章开头就放出这个方法然后来一句“这个方法一般就可以解决了。”</li><li>不推荐原因见<a href="https://juejin.cn/s/npm%20config%20set%20strict-ssl%20false">npm config set strict-ssl false-掘金 </a></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set strict-ssl false</span><br></pre></td></tr></table></figure><ul><li>参考文章<br><a href="https://blog.csdn.net/qq_60582586/article/details/134326231">npm安装时一直idealTree:npm: sill idealTree buildDeps解决方案-CSDN博客</a><br><a href="https://blog.csdn.net/PengXing_Huang/article/details/136460133">如何解决 npm install 卡在“sill idealTree buildDeps“的问题_idealtree:hgloginsystem: sill idealtree builddeps-CSDN博客</a><br><a href="https://rahul-shenoy.medium.com/unable-to-verify-leaf-signature-dadaba691f0b">npm 错误：UNABLE_TO_VERIFY_LEAF_SIGNATURE | 作者：Rahul Shenoy | Medium — npm Error: UNABLE_TO_VERIFY_LEAF_SIGNATURE | by Rahul Shenoy | Medium</a></li></ul>]]></content>
    
    
    <summary type="html">运行`npm install` 命令后，卡在`idealTree:xxx: sill idealTree buildDeps`很长时间后报错，清缓存换源无果后手动添加证书信任，问题解决。判断可能是cloudflare证书问题导致的。</summary>
    
    
    
    
    <category term="学习" scheme="https://blog.ahao.space/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>私人云游戏服务器搭建</title>
    <link href="https://blog.ahao.space/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/"/>
    <id>https://blog.ahao.space/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/</id>
    <published>2024-03-20T02:18:00.000Z</published>
    <updated>2024-04-02T08:47:57.951Z</updated>
    
    <content type="html"><![CDATA[<h1 id="方案：PVE8-1-x-安装-P40-vGPU-驱动并授权"><a href="#方案：PVE8-1-x-安装-P40-vGPU-驱动并授权" class="headerlink" title="方案：PVE8.1.x 安装 P40 vGPU 驱动并授权"></a>方案：PVE8.1.x 安装 P40 vGPU 驱动并授权</h1><h1 id="术语说明"><a href="#术语说明" class="headerlink" title="术语说明"></a>术语说明</h1><p>简单介绍后面内容中的几个术语：</p><ul><li><p>vGPU</p><p>  vGPU 技术通过将硬件 GPU 分割成多个虚拟 GPU 以支持多个虚拟机。每个虚拟 GPU 可以被分配给不同的虚拟机，从而使多个虚拟机拥有“独显”。</p></li><li><p>vGPU-unlock</p><p>  从硬件上来看，同代的数据中心显卡和消费者显卡 GPU 架构是一样的，只是驱动层限制了支持的特性。通过修改型号与宿主驱动等方式，将消费级显卡伪装成具有相同核心型号的专业卡，使得普通消费者显卡也可以支持虚拟化；对于虚拟机，同时在 vGPU 启动前后进行 hook，绕过特定检查、汇报虚假结果等，使得虚拟机的 vGPU 能正常启动。目前支持的消费卡型号可以参考<a href="https://foxi.buduanwang.vip/virtualization/1683.html">此文章</a>的第三点。</p></li><li><p>vGPU 授权机制</p><p>  在宿主机上，驱动无需授权。不过，只有企业级 GPU 能够被 vGPU 宿主机驱动所识别，消费级显卡无法合法地用于 vGPU 硬件。</p><p>  在虚拟机上，使用 vGPU 客户端驱动需要获得 NVIDIA 授权。不同能力的 vGPU 子设备被分为 A、B、C、Q 四类，并对应不同的授权费用。未获得授权的驱动会逐渐降低 vGPU 子设备的性能，最终导致无法使用。可参考：<a href="https://www.nvidia.com/content/Control-Panel-Help/vLatest/zh-cn/mergedProjects/nvlicCHS/About_GRID_Licensing_-_Reference.htm">关于 NVIDIA vGPU 软件许可</a>。</p><p>  在几种 vGPU 类型中，覆盖应用场景最广的是 Q 型 vGPU，授权为 vWS。</p></li></ul><h1 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h1><p>关于 PVE 使用 GPU 有三种方法：</p><ul><li>显卡直通</li><li>普通显卡 + vGPU-unlock</li><li>数据中心显卡 vGPU</li></ul><p>Tesla P40 是数据中心卡，原生支持 vGPU 功能，所以本文不涉及 vGPU-unlock，如需了解可以参考 PolloLoco 的 <a href="https://gitlab.com/polloloco/vgpu-proxmox">NVIDIA vGPU Guide</a>。</p><h1 id="安装流程（需自行配置BIOS）"><a href="#安装流程（需自行配置BIOS）" class="headerlink" title="安装流程（需自行配置BIOS）"></a>安装流程（需自行配置BIOS）</h1><h2 id="宿主机"><a href="#宿主机" class="headerlink" title="宿主机"></a>宿主机</h2><ol><li><p>主板 BIOS 配置（需自行配置）</p><p> 需要在主板 BIOS 中开启开启 IOMMU &#x2F; VT-d、Above 4G Decoding、SR-IOV，不同的主板选项所在位置可能不同，需要自行查找。</p><p> IOMMU 是一种地址映射技术，而 VT-d 是 Intel 对该技术的别称；Above 4G Decoding 关系到 PCI-E 设备 RAM 的 64 位寻址能力，通常用于需要让 CPU 访问全部显存的场景，使用 vGPU 时推荐开启；SR-IOV 允许一个 PCI-E 设备被多个虚拟机使用，常用于网卡等设备共享。</p></li><li><p>PVE 宿主机配置</p><p> 配置软件源，安装必要的软件包，配置内核，配置引导</p></li><li><p>安装 NVIDIA Host 驱动</p><p> NVIDIA 官网的驱动是非公开的，你需要注册 NVIDIA 商业账户才可访问；当然你也可以去网上寻找驱动包，比如：<a href="https://foxi.buduanwang.vip/pan/vGPU/">APQA 网盘</a>、<a href="https://github.com/VGPU-Community-Drivers/NV-VGPU-Driver">GitHub</a> 等</p></li></ol><h1 id="确认系统和驱动版本"><a href="#确认系统和驱动版本" class="headerlink" title="确认系统和驱动版本"></a>确认系统和驱动版本</h1><blockquote><p>版本信息：<br>root@pve :~# pveversion<br>pve-manager&#x2F;8.1.4&#x2F;ec 5 affc 9 e 41 f 1 d 79 (running kernel: 6.5.13-1-pve)</p></blockquote><p>（已废弃方案：kernel 降级安装 16.0 的 vGPU 驱动）</p><p>内核版本和 vGPU 软件版本对应可参考 <a href="https://pve.proxmox.com/wiki/NVIDIA_vGPU_on_Proxmox_VE">NVIDIA vGPU on Proxmox VE - Proxmox VE</a></p><table><thead><tr><th>pve-manager</th><th>kernel</th><th>vGPU Software Branch</th><th>NVIDIA Host drivers</th></tr></thead><tbody><tr><td>7.2-7</td><td>5.15.39-2-pve</td><td>14.1</td><td>510.73.06</td></tr><tr><td>7.2-7</td><td>5.15.39-2-pve</td><td>14.2</td><td>510.85.03</td></tr><tr><td>7.4-3</td><td>5.15.107-2-pve</td><td>15.2</td><td>525.105.14</td></tr><tr><td>7.4-17</td><td>6.2.16-20-bpo11-pve</td><td>16.0</td><td>535.54.06</td></tr><tr><td>8.1.4</td><td>6.5.11-8-pve</td><td>16.3</td><td>535.154.02</td></tr><tr><td>8.1.4</td><td>6.5.13-1-pve</td><td>16.3</td><td>535.154.02</td></tr></tbody></table><blockquote><p>本文使用 535.154.02 ，16.3 版本的驱动</p></blockquote><h1 id="开始部署"><a href="#开始部署" class="headerlink" title="开始部署"></a>开始部署</h1><h2 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h2><ul><li>在开始下列步骤之前，需要在主板 BIOS 中开启开启 IOMMU &#x2F; VT-d、Above 4 G Decoding、SR-IOV，不同的主板选项所在位置可能不同，需要自行查找，本文在此不作举例。</li></ul><h3 id="禁用企业源，添加国内源"><a href="#禁用企业源，添加国内源" class="headerlink" title="禁用企业源，添加国内源"></a>禁用企业源，添加国内源</h3><ul><li>Web 后台 禁用企业源</li></ul><p><img src="/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/Pastedimage20240301140858.png" alt="Pastedimage20240301140858"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 下载中科大的GPG KEY</span></span><br><span class="line">wget https://mirrors.ustc.edu.cn/proxmox/debian/proxmox-release-bookworm.gpg -O /etc/apt/trusted.gpg.d/proxmox-release-bookworm.gpg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用Proxmox非企业版源</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb https://mirrors.ustc.edu.cn/proxmox/debian bookworm pve-no-subscription&quot;</span> &gt; /etc/apt/sources.list.d/pve-no-subscription.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将Debian官方源替换为中科大源</span></span><br><span class="line">sed -i <span class="string">&#x27;s|^deb http://ftp.debian.org|deb https://mirrors.ustc.edu.cn|g&#x27;</span> /etc/apt/sources.list</span><br><span class="line">sed -i <span class="string">&#x27;s|^deb http://security.debian.org|deb https://mirrors.ustc.edu.cn/debian-security|g&#x27;</span> /etc/apt/sources.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换Ceph源</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb https://mirrors.ustc.edu.cn/proxmox/debian/ceph-quincy bookworm no-subscription&quot;</span> &gt; /etc/apt/sources.list.d/ceph.list</span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换CT镜像下载源</span></span><br><span class="line">sed -i <span class="string">&#x27;s|http://download.proxmox.com|https://mirrors.ustc.edu.cn/proxmox|g&#x27;</span> /usr/share/perl5/PVE/APLInfo.pm</span><br></pre></td></tr></table></figure><h3 id="安装必要软件包"><a href="#安装必要软件包" class="headerlink" title="安装必要软件包"></a>安装必要软件包</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update &amp;&amp; apt install dkms  git build-essential pve-kernel-5.15 pve-headers-5.15 dkms cargo jq uuid-runtime -y</span><br></pre></td></tr></table></figure><h3 id="配置内核"><a href="#配置内核" class="headerlink" title="配置内核"></a>配置内核</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> vfio &gt;&gt; /etc/modules </span><br><span class="line"><span class="built_in">echo</span> vfio_iommu_type1 &gt;&gt; /etc/modules </span><br><span class="line"><span class="built_in">echo</span> vfio_pci &gt;&gt; /etc/modules </span><br><span class="line"><span class="built_in">echo</span> vfio_virqfd &gt;&gt; /etc/modules</span><br><span class="line"><span class="built_in">echo</span>  <span class="string">&quot;blacklist nouveau&quot;</span> &gt;&gt; /etc/modprobe.d/blacklist.conf</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;options kvm ignore_msrs=1&quot;</span> &gt; /etc/modprobe.d/kvm.conf </span><br><span class="line">update-initramfs -k all -u</span><br></pre></td></tr></table></figure><h3 id="配置引导"><a href="#配置引导" class="headerlink" title="配置引导"></a>配置引导</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#编辑grub，请不要盲目改。根据自己的环境，选择设置</span></span><br><span class="line">nano /etc/default/grub </span><br><span class="line"><span class="comment">#在里面找到：</span></span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=<span class="string">&quot;quiet&quot;</span> </span><br><span class="line"><span class="comment">#然后修改为：</span></span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=<span class="string">&quot;quiet intel_iommu=on&quot;</span> </span><br><span class="line"><span class="comment">#如果是amd cpu请改为：</span></span><br><span class="line">GRUB_CMDLINE_LINUX_DEFAULT=<span class="string">&quot;quiet amd_iommu=on&quot;</span></span><br><span class="line"><span class="comment">#更新引导</span></span><br><span class="line">update-grub</span><br><span class="line"></span><br><span class="line"><span class="comment">#环境配置完成，重启生效</span></span><br><span class="line">reboot</span><br></pre></td></tr></table></figure><h2 id="验证环境配置"><a href="#验证环境配置" class="headerlink" title="验证环境配置"></a>验证环境配置</h2><blockquote><p>再次检查内核版本</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -r</span><br><span class="line"><span class="comment">#6.5.13-1-pve</span></span><br></pre></td></tr></table></figure><blockquote><p>验证是否开启iommu</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dmesg | grep iommu <span class="comment">#查询命令</span></span><br><span class="line"></span><br><span class="line">出现有如下iommu group说明成功</span><br><span class="line">root@pve:~<span class="comment"># dmesg | grep iommu</span></span><br><span class="line">[    0.000000] Command line: BOOT_IMAGE=/boot/vmlinuz-6.5.13-1-pve root=/dev/mapper/pve-root ro quiet intel_iommu=on</span><br><span class="line">[    0.588407] Kernel <span class="built_in">command</span> line: BOOT_IMAGE=/boot/vmlinuz-6.5.13-1-pve root=/dev/mapper/pve-root ro quiet intel_iommu=on</span><br><span class="line">[    2.479162] iommu: Default domain <span class="built_in">type</span>: Translated</span><br><span class="line">[    2.479162] iommu: DMA domain TLB invalidation policy: lazy mode</span><br><span class="line">[    2.551750] pci 0000:80:01.0: Adding to iommu group 0</span><br><span class="line">[    2.551840] pci 0000:80:02.0: Adding to iommu group 1</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[    2.588880] pci 0000:ff:1f.2: Adding to iommu group 100</span><br><span class="line">[   50.303181] nvidia-vgpu-vfio 00000000-0000-0000-0000-000000000104: Adding to iommu group 101</span><br></pre></td></tr></table></figure><blockquote><p>验证nouveau是否未启用</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">lsmod  | grep nouveau <span class="comment">#查询命令</span></span><br><span class="line"></span><br><span class="line">无输出，代表未启用</span><br><span class="line">root@pve3:~<span class="comment"># lsmod|grep nouveau</span></span><br><span class="line">root@pve3:~<span class="comment"># </span></span><br></pre></td></tr></table></figure><h2 id="下载并安装vGPU-驱动"><a href="#下载并安装vGPU-驱动" class="headerlink" title="下载并安装vGPU 驱动"></a>下载并安装vGPU 驱动</h2><ul><li><p>从 APQA 云盘下载驱动压缩包 <a href="https://foxi.buduanwang.vip/pan/vGPU/16.3/NVIDIA-GRID-Linux-KVM-535.154.02-535.154.05-538.15.zip">下载链接</a><br>（包括宿主机-host 和虚拟机-guest 的驱动程序和文档等，十分贴心）</p></li><li><p>下载压缩包解压后，将 Host_Drivers 文件夹中的 NVIDIA-Linux-x 86_64-535.154.02-vgpu-kvm. run上传到 pve，并执行安装</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#r如果安装了显卡驱动，先卸载</span></span><br><span class="line">./NVIDIA-Linux-x86_64-535.154.02-vgpu-kvm.run --uninstall</span><br><span class="line">sudo apt-get remove --purge nvidia-*</span><br><span class="line"></span><br><span class="line"><span class="built_in">chmod</span> +x NVIDIA-Linux-x86_64-535.154.02-vgpu-kvm.run</span><br><span class="line">./NVIDIA-Linux-x86_64-535.154.02-vgpu-kvm.run</span><br></pre></td></tr></table></figure><p>（示例安装图是旧版方案的，懒得替换了，流程是一致的）<br><img src="/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/Pastedimage20240306094701.png" alt="Pastedimage20240306094701"></p><blockquote><p>以DKMSs方式安装驱动（选择 YES）</p></blockquote><p><img src="/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/Pastedimage20240306094717.png" alt="Pasted image 20240306094717"><br><img src="/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/Pastedimage20240306094730.png" alt="Pasted image 20240306094730"></p><blockquote><p>显示安装完成后，检查驱动</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvidia-smi</span><br></pre></td></tr></table></figure><ul><li>如正常显示，则安装成功可进行下一步。</li><li><img src="/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/Pastedimage20240316203655.png" alt="Pasted image 20240316203655"></li></ul><hr><h2 id="直通设备给虚拟机"><a href="#直通设备给虚拟机" class="headerlink" title="直通设备给虚拟机"></a>直通设备给虚拟机</h2><h3 id="Win-10"><a href="#Win-10" class="headerlink" title="Win 10"></a>Win 10</h3><h4 id="获取物理-GPU-的-PCI-设备-bus-x2F-device-x2F-function-BDF"><a href="#获取物理-GPU-的-PCI-设备-bus-x2F-device-x2F-function-BDF" class="headerlink" title="获取物理 GPU 的 PCI 设备 bus&#x2F;device&#x2F;function (BDF):"></a>获取物理 GPU 的 PCI 设备 bus&#x2F;device&#x2F;function (BDF):</h4><ul><li>获取 GPU 设备的 BDF</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lspci | grep NVIDIA</span><br></pre></td></tr></table></figure><blockquote><p>此时看到的物理 GPU 设备如下:<br><code>04:00.0 3D controller: NVIDIA Corporation GP102GL [Tesla P40] (rev a1)</code><br>这里显示输出的 <code>04:00.0</code> 就是 GPU 的 PCI 设备 BDF</p></blockquote><h4 id="扫描输出对应的-NVIDIA-Virtual-GPU-组合设备规格"><a href="#扫描输出对应的-NVIDIA-Virtual-GPU-组合设备规格" class="headerlink" title="扫描输出对应的 NVIDIA Virtual GPU 组合设备规格:"></a>扫描输出对应的 NVIDIA Virtual GPU 组合设备规格:</h4><blockquote><p>使用 <code>mdevctl types</code> 命令扫描 <code>mdev_suppo #Site01rted_types </code> 目录获得 NVIDIA Virtual GPU (vGPU) 设备配置</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mdevctl types</span><br></pre></td></tr></table></figure><blockquote><p>可以看到不同规格 vGPU 命名以及对应配置, 即为配置完成</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@pve:~# mdevctl types</span><br><span class="line">0000:04:00.0</span><br><span class="line">  nvidia-156</span><br><span class="line">    Available instances: 0</span><br><span class="line">    Device API: vfio-pci</span><br><span class="line">    Name: GRID P40-2B</span><br><span class="line">    Description: num_heads=4, frl_config=45, framebuffer=2048M, max_resolution=5120x2880, max_instance=12</span><br><span class="line">  nvidia-215</span><br><span class="line">    Available instances: 0</span><br><span class="line">    </span><br><span class="line">... ...</span><br><span class="line"></span><br><span class="line">   Description: num_heads=1, frl_config=60, framebuffer=24576M, max_resolution=1280x1024, max_instance=1</span><br><span class="line">  nvidia-62</span><br><span class="line">    Available instances: 0</span><br><span class="line">    Device API: vfio-pci</span><br><span class="line">    Name: GRID P40-1B</span><br><span class="line">    Description: num_heads=4, frl_config=45, framebuffer=1024M, max_resolution=5120x2880, max_instance=24</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>每种规格末尾有一个 A&#x2F;B&#x2F;C&#x2F;Q 标识类型 </li><li>vGPU 类型和用途关系</li></ul><table><thead><tr><th>类型</th><th>建议用途</th></tr></thead><tbody><tr><td>A</td><td>虚拟应用程序(Virtual Applications &#x2F; vApps)</td></tr><tr><td>B</td><td>虚拟桌面(Virtual Desktops &#x2F; vPC)</td></tr><tr><td>C</td><td>AI&#x2F;机器学习&#x2F;训练( vCS or vWS )</td></tr><tr><td>Q</td><td>虚拟工作站 (Virtual Workstations &#x2F; vWS)</td></tr></tbody></table><h3 id="给虚拟机分配-vGPU"><a href="#给虚拟机分配-vGPU" class="headerlink" title="给虚拟机分配 vGPU"></a>给虚拟机分配 vGPU</h3><blockquote><p>登录 PVE Web 后台，在对应的 Windows 虚拟机下添加原始设备（对应设备 BDF）<br>按需配置显存大小，本例使用 Q 通用型 12G 显存</p></blockquote><p><img src="/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/Pastedimage20240317083344.png" alt="Pasted image 20240317083344"></p><h3 id="Windows-安装-GRID-驱动"><a href="#Windows-安装-GRID-驱动" class="headerlink" title="Windows 安装 GRID 驱动"></a>Windows 安装 GRID 驱动</h3><ul><li>为后续方便操作，建议提前在 PVE Web 后台使用 NoVNC 操作开启对应虚拟机 <a href="https://blog.csdn.net/u012228009/article/details/80707426">RDP</a></li></ul><blockquote><p>启动 Windows 虚拟机，将驱动包中的 Guest_Drivers 中的538.15_grid_win10_win11_server2019_server2022_dch_64bit_international.exe<br>上传到虚拟机，并安装（过程略，下一步就行）</p><p>驱动安装时记得选择安装虚拟屏幕驱动，最高支持 7680 x 5120 的分辨率，（虽然串流只支持 4K</p></blockquote><h3 id="vGPU-授权"><a href="#vGPU-授权" class="headerlink" title="vGPU 授权"></a>vGPU 授权</h3><h4 id="授权流程"><a href="#授权流程" class="headerlink" title="授权流程"></a>授权流程</h4><p>授权方法分为如下几种方式：</p><ol><li>向 NVIDIA 申请 90 天 free license（NVIDIA 中国只面向企业用户发放免费授权，个人可以尝试去海外官网申请），到期后购买 license<br>(注册后要和邮件说明注册理由，地址填 HongKong 给我安排纯英文商务邮件)</li><li><a href="https://github.com/mbilker/vgpu_unlock-rs">Rust-based vgpu_unlock</a>，通过 vGPU 伪装，从而可以在虚拟机使用不需要授权的消费级显卡驱动，此方式是唯一支持消费级显卡的方式</li><li><a href="https://github.com/KrutavShah/vGPU_LicenseBypass">vGPU_LicenseBypass</a>，此方式将不限制性能的时间从 20 分钟延长为一天，并且每天定时重启驱动，以达成一直不受限的目地，但不适合需要长时间运行 GPU 的场景</li><li><a href="https://hub.docker.com/r/collinwebdesigns/fastapi-dls">FastAPI-DLS</a>，此方式通过模拟正规流程的激活服务器，对虚拟机进行许可证授权，支持容器部署</li></ol><p>对于原生支持 vGPU 的显卡而言，使用 FastAPI-DLS 为最优解，整套方案除授权服务器虚假外与正规流程无异。而且只要不更新虚拟机驱动，证书验证算法不变，理论具有等同于正规授权的稳定性。</p><h4 id="搭建授权服务器"><a href="#搭建授权服务器" class="headerlink" title="搭建授权服务器"></a>搭建授权服务器</h4><ol><li>首先安装容器环境，此步略过。</li><li>启动容器，原项目需要自行创建证书，这里使用一个二次封装的免证书容器镜像。</li></ol><ul><li>本例中使用授权服务器 IP 10.0.0.6，仅作举例，记得替换成自己的<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此处的DLS_URL与DLS_PORT是后续生成授权文件，告知Guest如何访问授权容器IP地址和端口</span></span><br><span class="line"><span class="comment"># 需替换DLS_URL为授权服务器ip（可在本机docker环境搭建，替换为本机IP）</span></span><br><span class="line">docker run -d -e DLS_URL=10.0.0.6 -e DLS_PORT=443 -p 443:443  makedie/fastapi-dls</span><br></pre></td></tr></table></figure></li></ul><h4 id="获取授权"><a href="#获取授权" class="headerlink" title="获取授权"></a>获取授权</h4><ul><li>使用管理员身份启动 PowerShell 执行如下命令</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &lt;ls-hostname-or-ip&gt;为你的授权服务IP端口</span></span><br><span class="line">curl.exe --insecure -L -X GET https://10.0.0.6/-/client-token -o <span class="string">&quot;C:\Program Files\NVIDIA Corporation\vGPU Licensing\ClientConfigToken\client_configuration_token_<span class="subst">$($(Get-Date)</span>.tostring(&#x27;dd-MM-yy-hh-mm-ss&#x27;)).tok&quot;</span> </span><br><span class="line"></span><br><span class="line">Restart-Service NVDisplay.ContainerLocalSystem</span><br><span class="line">nvidia-smi.exe -q | Select-String License </span><br><span class="line"><span class="comment"># 查看授权状态</span></span><br></pre></td></tr></table></figure><p><img src="/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/Pastedimage20240317094525.png" alt="Pasted image 20240317094525"></p><ul><li>现在 vGPU 已经可以正常使用了，只要确保授权服务容器正常运行，grid 驱动就会自动续期</li><li>DEBUG：如显示授权失败可尝试 <a href="https://www.bilibili.com/read/cv23075952/"># 来自民间的NVIDIA VGPU授权fastapi-dls</a> 中最后的”<u>应用授权</u>“部分方法手动下载文件，然后重启</li></ul><h2 id="pve-7-x2F-8-kvmqemu-反虚拟化检测（可选）"><a href="#pve-7-x2F-8-kvmqemu-反虚拟化检测（可选）" class="headerlink" title="# pve 7&#x2F;8 kvmqemu 反虚拟化检测（可选）"></a># pve 7&#x2F;8 kvmqemu 反虚拟化检测（可选）</h2><ul><li>如要运行的程序不支持在虚拟机中运行，可参考这一步反虚拟化检测教程</li><li></li><li>参考文章：<a href="https://www.bilibili.com/read/cv26245305/">pve7 pve8 kvmqemu反虚拟化检测显卡直通玩游戏教程 (bilibili.com)</a></li><li>所使用的项目链接：<ul><li><a href="https://github.com/zhaodice/proxmox-ve-anti-detection">https://github.com/zhaodice/proxmox-ve-anti-detection</a></li><li><a href="https://github.com/zhaodice/qemu-anti-detection">https://github.com/zhaodice/qemu-anti-detection</a></li></ul></li></ul><blockquote><p>1.更为安全的方式：参照上文和项目对应 kvm 版本（或 PVE 版本），自行编译（在此不再赘述）</p><p>2.最简单快捷的方式：在 <a href="https://www.bilibili.com/read/cv26245305/">Q群中)</a> 找到对应版本已经编译好的 deb 文件，直接安装<br><strong>请务必确认版本，Web 端左上角 Virtual Environment 8.1.4 这个和 kvm 包比如 8.0.2-4 版本是不一样的哈</strong></p></blockquote><blockquote><p>查看你目前使用的 kvm 版本：</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -l | grep kvm </span><br></pre></td></tr></table></figure><p><img src="/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/Pastedimage20240317091446.png" alt="Pasted image 20240317091446"></p><blockquote><p>下载并上传到 pve ，<br>使用 dpkg 安装</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg -i pve-qemu-kvm_Your_KVM_Version_amd64_anti_detection.deb</span><br></pre></td></tr></table></figure><blockquote><p>在 Web 后台修改对应虚拟机 bios 为 ovmf，机型选 i440</p><p>然后在虚拟机配置文件中添加参数<br>虚拟机配置文件在 &#x2F;etc&#x2F;pve&#x2F;qemu-server&#x2F;xxx.conf （ xxx 为对应的虚拟机 ID ）<br>使用 vim 打开，并添加：</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">args: -cpu host,hypervisor=off,vmware-cpuid-freq=false,enforce=false,host-phys-bits=true, -smbios type=0,vendor=&quot;American Megatrends International LLC.&quot;,version=H3.7G,date=&#x27;02/21/2023&#x27; -smbios type=1,manufacturer=&quot;Maxsun&quot;,product=&quot;MS-Terminator B760M&quot;,version=&quot;VER:H3.7G(2022/11/29)&quot; -smbios type=2,manufacturer=&quot;Maxsun&quot;,product=&quot;MS-Terminator B760M&quot;,version=&quot;VER:H3.7G(2022/11/29)&quot; -smbios type=17,manufacturer=&quot;KINGSTON&quot;,speed=3200,serial=DF1EC466,part=SED3200U1888S</span><br></pre></td></tr></table></figure><p><img src="/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/Pastedimage20240317092447.png" alt="Pasted image 20240317092447"></p><blockquote><p>启动 Windows 虚拟机，如看到下图所示设备名，则配置完成</p></blockquote><p><img src="/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/Pastedimage20240317101032.png" alt="Pasted image 20240317101032"></p><blockquote><p>可顺带使用群内虚拟机检测软件进行测试</p></blockquote><p><img src="/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/Pastedimage20240317101047.png" alt="Pastedimage20240317101047"></p><h3 id="Linux-（还没开始玩）"><a href="#Linux-（还没开始玩）" class="headerlink" title="Linux （还没开始玩）"></a>Linux （还没开始玩）</h3><hr><p>至此，完成部署</p><hr><h1 id="游戏串流"><a href="#游戏串流" class="headerlink" title="游戏串流"></a>游戏串流</h1><h2 id="使用方案"><a href="#使用方案" class="headerlink" title="使用方案"></a>使用方案</h2><ul><li><p>Parsec</p><p>  在(<a href="https://parsec.app/">Parsec</a> 注册账号，并两端下载客户端登录同一账号即可<br>  <a href="https://www.bilibili.com/video/BV1Yx4y1Q7Bi">【串流完全入门教程】 链接</a></p></li><li><p>SunShine – Moonlight<br>  <a href="https://www.bilibili.com/video/BV1NF4m1L7of/">【安卓使用 JoyCon 手柄串流 PC 】 链接</a><br>  <a href="%5Bhttps://www.bilibili.com/video/BV1Si4y1Y7Jb/">【Moonlight 多点触控】 链接</a></p></li></ul><h2 id="实测"><a href="#实测" class="headerlink" title="实测"></a>实测</h2><ul><li><p>需要每次开机后使用 RDP 连接，然后 vGPU 验证授权才会执行，之后就可以使用 Parsec 串流了（小问题）</p></li><li><p>串流时没间隔一段时间有卡顿（瞬时延迟高、编解码耗时长），未找到原因，怀疑是 SATA 固态读写问题，考虑换 NVME （nmon 查看磁盘读写占用在地图加载等场景中占用高）</p></li><li><p><img src="/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/Snipaste_2024-03-14_21-31-54.jpg" alt="Snipaste_2024-03-14_21-31-54"></p></li><li><p><img src="/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/blog111.png" alt="blog111"></p></li><li><p>我的 PVE (一堆虚拟机)上唯一一块 Intel 1.6T SATA 固态盘：</p></li><li><p><img src="/2024/03/20/%E7%A7%81%E4%BA%BA%E4%BA%91%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA/245d0a87d1c985e4723604fde01b9a0.png" alt="245d0a87d1c985e4723604fde01b9a0"></p></li><li><p>2024 年 3 月 28 日更新：已购入二手 Inte; P4610 1.6 T ，待部署，后面补充换盘后测试结果。</p></li></ul><h1 id="图穷匕见"><a href="#图穷匕见" class="headerlink" title="图穷匕见"></a>图穷匕见</h1><p>其实，这一篇教你怎么<del>PVE8.1.x 安装 P40 vGPU 驱动并授权，实现私人云游戏</del> 玩原神的文章</p><p>欸嘿⭐~</p><p>参考文献</p><blockquote><p><a href="https://github.com/ProTechEx/vgpu-proxmox">ProTechEx&#x2F;vgpu-proxmox (github.com)</a><br><a href="https://github.com/GreenDamTan/fastapi-dls">GreenDamTan&#x2F;fastapi-dls (github.com)</a><br><a href="https://github.com/zhaodice/proxmox-ve-anti-detection">zhaodice&#x2F;proxmox-ve-anti-detection: A patch to hide PVE itself (github.com)</a><br><a href="https://cloud-atlas.readthedocs.io/zh-cn/latest/kvm/vgpu/install_vgpu_manager.html">安装NVIDIA Virtual GPU Manager — Cloud Atlas beta 文档 (cloud-atlas.readthedocs.io)</a><br><a href="https://pve-doc-cn.readthedocs.io/zh-cn/pve-nvidia-vgpu/configure.html">第四章 配置vGPU — Proxmox VE Nvidia-vGPU doc 6.4 文档 (pve-doc-cn.readthedocs.io)</a><br><a href="https://fairysen.com/844.html">在Proxmox VE下开启vGPU - Tesla P4为例 - 雾时之森 (fairysen.com)</a><br><a href="https://xinalin.com/159/vgpu-configuration-on-pve">vGPU在Proxmox VE下的配置与使用 – 雪林荧光 (xinalin.com)</a><br><a href="https://www.azimiao.com/9289.html">PVE+Tesla P4 vGPU All IN ONE NAS 折腾小记 | 梓喵出没 (azimiao.com)</a><br><a href="https://foxi.buduanwang.vip/vdi/640.html/">佛西博客 - 基于Proxmox VE的VDI云桌面解决方案 (buduanwang.vip)</a><br><a href="https://foxi.buduanwang.vip/pve/proxmox-ve-vgpu/">佛西博客 - Proxmox VE vGPU 教程汇总 (buduanwang.vip)</a></p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;方案：PVE8-1-x-安装-P40-vGPU-驱动并授权&quot;&gt;&lt;a href=&quot;#方案：PVE8-1-x-安装-P40-vGPU-驱动并授权&quot; class=&quot;headerlink&quot; title=&quot;方案：PVE8.1.x 安装 P40 vGPU 驱动并授权&quot;&gt;&lt;/a</summary>
      
    
    
    
    
    <category term="#Site01" scheme="https://blog.ahao.space/tags/Site01/"/>
    
    <category term="云计算" scheme="https://blog.ahao.space/tags/%E4%BA%91%E8%AE%A1%E7%AE%97/"/>
    
  </entry>
  
  <entry>
    <title>Todo List</title>
    <link href="https://blog.ahao.space/2023/08/11/Todo/"/>
    <id>https://blog.ahao.space/2023/08/11/Todo/</id>
    <published>2023-08-11T09:42:40.000Z</published>
    <updated>2024-04-12T08:49:18.957Z</updated>
    
    <content type="html"><![CDATA[<ul><li><input disabled="" type="checkbox"> 启用字数统计 </li><li><input disabled="" type="checkbox"> 配置 About 页面 </li><li><input disabled="" type="checkbox"> 配置 404 页面 </li><li><input checked="" disabled="" type="checkbox"> 启用 RSS 订阅 </li><li><input disabled="" type="checkbox"> 启用 Mermaid </li><li><input disabled="" type="checkbox"> 启用 LaTeX 数学公式 </li><li><input disabled="" type="checkbox"> 启用自定义字体 </li><li><input disabled="" type="checkbox"> 自定义单独文章页头图 </li><li><input disabled="" type="checkbox"> 将 Unsplash 的随机图片作为头图 </li><li><input disabled="" type="checkbox"> 自定义文章在首页的摘要 </li><li><input disabled="" type="checkbox"> 自定义主题颜色 </li><li><input disabled="" type="checkbox"> 切换代码配色方案 </li><li><input disabled="" type="checkbox"> 设置文章版权信息 </li><li><input disabled="" type="checkbox"> 启用 Algolia 搜索 </li><li><input disabled="" type="checkbox"> 切换为英文界面</li></ul>]]></content>
    
    
    <summary type="html">Todo</summary>
    
    
    
    <category term="Todo List" scheme="https://blog.ahao.space/categories/Todo-List/"/>
    
    
    <category term="学习" scheme="https://blog.ahao.space/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="折腾" scheme="https://blog.ahao.space/tags/%E6%8A%98%E8%85%BE/"/>
    
  </entry>
  
  <entry>
    <title>TrueNAS Scale 从入门到入土</title>
    <link href="https://blog.ahao.space/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/"/>
    <id>https://blog.ahao.space/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/</id>
    <published>2023-08-10T13:15:40.000Z</published>
    <updated>2024-03-23T04:53:53.577Z</updated>
    
    <content type="html"><![CDATA[<ul><li>本文章基于视频教程，文字部分是对视频内容的扩展和概念补充，加个人经验</li><li>如初次入门，建议看完视频前三课。</li></ul><h1 id="详细系列教程："><a href="#详细系列教程：" class="headerlink" title="详细系列教程："></a>详细系列教程：</h1><p><a href="https://www.truenasscale.com/">Sagit - Blog</a> 详尽的博客，也有视频</p><p>或者司波图的视频教程</p><div style="position: relative; width: 100%; height: 0; padding-bottom: 75%;"><iframe src="//player.bilibili.com/player.html?aid=433381187&bvid=BV1gG411T751&cid=914079066&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" style="position: absolute; width: 100%; height: 100%; left: 0; top: 0;"> </iframe></div><h2 id="视频教程内容涵括以下几点："><a href="#视频教程内容涵括以下几点：" class="headerlink" title="视频教程内容涵括以下几点："></a>视频教程内容涵括以下几点：</h2><p><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-0.png" alt="TrueNAS_Scale从入门到入土-0"><br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-1.png" alt="TrueNAS_Scale从入门到入土-1"><br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-2.png" alt="TrueNAS_Scale从入门到入土-2"></p><h1 id="前身-amp-优势和功能"><a href="#前身-amp-优势和功能" class="headerlink" title="前身 &amp; 优势和功能"></a>前身 &amp; 优势和功能</h1><ul><li><a href="https://www.truenas.com/freenas/">TrueNAS Scale前身</a>为 iXsystems推出的FreeNAS（因基于FreeBSD而得名）； </li><li>FreeNAS的主要优点是使用ZFS（提升了文件的安全性，并且支持快照和写时复制功能，方便地进行读写操作，同时还可以对文件进行分块校验以去重，节约存储空间）FreeNAS更名为TrueNAS Core；不足之处：硬件支持更新较慢，无法原生支持Docker应用。</li><li>TrueNAS Scale是在TrueNAS Core的基础上，基于Debian Linux内核进一步开发的版本，它增加了对Docker的支持，并且换了基于KVM的虚拟化功能，对硬件直通和显卡调用、社区软件支持度都不错</li></ul><p>那么古尔丹，代价是什么？<br>       ZFS数据恢复难度高价格更贵；且储存池加密后损坏无法恢复数据<br>      所以务必做好阵列冗余，别当亡命之徒）</p><h1 id="硬件需求："><a href="#硬件需求：" class="headerlink" title="硬件需求："></a>硬件需求：</h1><p>（详见<a href="https://www.truenas.com/docs/scale/gettingstarted/scalehardwareguide/"><strong>官方文档</strong></a>）<br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-3.png" alt="TrueNAS_Scale从入门到入土-3"></p><ul><li><p>强烈建议使用ECC(或RECC)来避免在使用内存缓存时造成的数据损坏</p></li><li><p>如需使用jellyfin emby plex等作为媒体服务器播放视频需要考虑硬件解码问题；建议提前了解 <a href="https://zhuanlan.zhihu.com/p/559028359">各个显卡对H265&#x2F;VP9&#x2F;AV1等硬件解码支持情况</a> 并加装独立显卡。</p><p>  显卡硬解性能表现可参考1050ti 4G，可支持4K电影原盘 HEVC硬解（测试使用电影。。。)实际表现  &#x2F;s</p></li></ul><h1 id="理论部分"><a href="#理论部分" class="headerlink" title="理论部分"></a>理论部分</h1><h2 id="TrueNAS基本使用架构："><a href="#TrueNAS基本使用架构：" class="headerlink" title="TrueNAS基本使用架构："></a>TrueNAS基本使用架构：</h2><p>自制的示例图：<br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-4.png" alt="TrueNAS_Scale从入门到入土-4"></p><h2 id="ZFS"><a href="#ZFS" class="headerlink" title="ZFS"></a><a href="https://zh.wikipedia.org/wiki/ZFS">ZFS</a></h2><h2 id="阵列类型-RAID-和-RAID-Z"><a href="#阵列类型-RAID-和-RAID-Z" class="headerlink" title="阵列类型:RAID 和 RAID-Z"></a>阵列类型:RAID 和 RAID-Z</h2><h3 id="RAID"><a href="#RAID" class="headerlink" title="RAID"></a>RAID</h3><ul><li><strong>独立硬盘冗余阵列</strong>（<strong>RAID</strong>, <strong>R</strong>edundant <strong>A</strong>rray of <strong>I</strong>ndependent <strong>D</strong>isks）  </li><li>简称<strong>磁盘阵列</strong>。利用虚拟化存储技术把多个硬盘组合起来，成为一个或多个硬盘阵列组，目的为提升性能或资料冗余，或是两者同时提升。</li></ul><p>详见  <a href="https://de.wikipedia.org/wiki/RAID"><strong>wikipedia.org</strong></a>（左边菜单栏最下面可切换中文)</p><h3 id="RAID-Z-TrueNAS中使用）"><a href="#RAID-Z-TrueNAS中使用）" class="headerlink" title="RAID-Z (TrueNAS中使用）"></a>RAID-Z (TrueNAS中使用）</h3><ul><li>是一种使用 ZFS 文件系统的非标准 RAID；该阵列不能使用其他文件系统。注：目前还没有一种硬件控制器能实现 RAID-Z</li></ul><p>详见 **  **<a href="https://www.diskinternals.com/raid-recovery/what-is-raidz/"><strong>diskinternals.com</strong></a><br>RAID-Z容量计算器：<a href="https://raidcalculators.com/zfs-raidz-capacity.php"><strong>https://raidcalculators.com/zfs-raidz-capacity.php</strong></a></p><h3 id="Mirror"><a href="#Mirror" class="headerlink" title="Mirror"></a>Mirror</h3><ul><li>镜像，指两个硬盘存储同样的文件，但读写速度没有提升(实测)</li></ul><h3 id="Stripe"><a href="#Stripe" class="headerlink" title="Stripe"></a>Stripe</h3><ul><li>条带，将所有硬盘组成一个Vdev，利用所有空间，但单个硬盘损坏就会导致整个vdev损毁且无法恢复(每个文件分成多份存在每一个硬盘中)</li><li>单个硬盘也算Stripe</li></ul><h2 id="Vdev"><a href="#Vdev" class="headerlink" title="Vdev"></a>Vdev</h2><ul><li>是Vitural Device 的简写，译为虚拟设备，这些虚拟设备可以是原始磁盘，也可能是一个组成阵列的多磁盘组</li></ul><h2 id="储存池"><a href="#储存池" class="headerlink" title="储存池"></a>储存池</h2><ul><li>由 Vdev 组成(可以多个）</li><li>当储存池中由两个或以上的Vdev组成时，他们的阵列类型必须相同</li><li>可在有多组不同容量物理磁盘时使用按容量分组Vdev再创建储存池，可避免按最小容量的盘计算总大小造成的容量损失</li></ul><p>例如:   四个 3.64T 和 四个 5.46T，两种容量分别组Vdev 并同样划分RAID-Z；<br>      实际容量   27.28TiB (3.64<em>3+5.46</em>3)，而非21.84(3.64*6)</p><ul><li>储存池中的Vdev之间以条带Stripe(类似RAID0)连接 组成存储池，所以当储存池有大于一个Vdev时，任一Vdev在故障盘超过对应阵列类型的安全冗余数量将造成储存池损毁。</li></ul><h2 id="降级"><a href="#降级" class="headerlink" title="降级"></a>降级</h2><p>别慌，降级指vdev因为硬盘损坏导致安全等级下降但因为冗余仍可保证数据安全。<br>(此处“恢复指安全等级恢复，并非指数据恢复。因为数据并未丢失）</p><ul><li>此时重新连接丢失的硬盘就可以自动修复</li><li>恢复时的resilvering指把丢失硬盘期间写入储存池的新数据写入到重新连接的盘中</li><li>resilver过程中掉了另一个盘的话，resilver和写入的数据都会挂掉）</li></ul><h1 id="实际操作部分"><a href="#实际操作部分" class="headerlink" title="实际操作部分"></a>实际操作部分</h1><h2 id="储存池扩展"><a href="#储存池扩展" class="headerlink" title="储存池扩展"></a>储存池扩展</h2><h3 id="方法一：新硬盘"><a href="#方法一：新硬盘" class="headerlink" title="方法一：新硬盘"></a>方法一：新硬盘</h3><p>在左侧选择”储存”选项卡，点管理未使用的硬盘并选择添加到已存在的储存池<br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-5.png" alt="TrueNAS_Scale从入门到入土-5"></p><ul><li>新硬盘会组成一个新的vdev加入到储存池中，</li><li>注意新加硬盘大小和数量应尽量与原有的vdev保持一致，以确保稳定性</li></ul><h3 id="方法二：替换为更大容量的盘"><a href="#方法二：替换为更大容量的盘" class="headerlink" title="方法二：替换为更大容量的盘"></a>方法二：替换为更大容量的盘</h3><p>在左侧选择”储存”选项卡，找到需要扩展的储存池并点击管理设备<br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-6.png" alt="TrueNAS_Scale从入门到入土-6"><br>选择你要替换的硬盘并点击替换<br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-7.png" alt="TrueNAS_Scale从入门到入土-7"><br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-8.png" alt="TrueNAS_Scale从入门到入土-8"><br>需要注意RAID会以最小的磁盘大小来计算空间，所以需要替换全部原有的硬盘</p><h3 id="方法三：新硬盘建立新的储存池"><a href="#方法三：新硬盘建立新的储存池" class="headerlink" title="方法三：新硬盘建立新的储存池"></a>方法三：新硬盘建立新的储存池</h3><h2 id="储存池迁移"><a href="#储存池迁移" class="headerlink" title="储存池迁移"></a>储存池迁移</h2><p>export，import  其余交给Truenas<br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-9.png" alt="TrueNAS_Scale从入门到入土-9"></p><h2 id="故障恢复："><a href="#故障恢复：" class="headerlink" title="故障恢复："></a>故障恢复：</h2><p>步骤与替换硬盘类似，需要找到removed的盘然后替换<br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-10.png" alt="TrueNAS_Scale从入门到入土-10"></p><h2 id="储存池加密"><a href="#储存池加密" class="headerlink" title="储存池加密"></a>储存池加密</h2><pre><code>   ~~哦~我的上帝啊，我是说...天呐，我的朋友,这是本地的磁盘加密，而又有谁能够来到你家并打开你的房门机柜门；移除机箱侧板或任何挡在他和你的硬盘之间的东西，然后取出硬盘，读取数据呢？  思考！别像那愚蠢的土拨鼠一样固执，你得反思一下你的数据有没有懂技术的人觊觎；是否如此重要，以至于你要舍弃那一点数据恢复的可能都要上这一道可悲的锁。（~~~~**加密的 RAID-Z 阵列 在损毁后几乎没有数据救援可能）**~~  对于企业、工作室和对安全性有额外要求的用户，这无疑是一个不错的选择：</code></pre><p>只需在创建池时选择加密即可。</p><ul><li>如果处理器支持AES加速那么读写速度几乎没有影响</li><li>别丢了密钥(json文件)，失去密钥无法恢复</li></ul><p><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-11.png" alt="TrueNAS_Scale从入门到入土-11"><br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-12.png" alt="TrueNAS_Scale从入门到入土-12"><br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-13.png" alt="TrueNAS_Scale从入门到入土-13"></p><h2 id="文件权限设置"><a href="#文件权限设置" class="headerlink" title="文件权限设置"></a>文件权限设置</h2><h3 id="数据集"><a href="#数据集" class="headerlink" title="数据集"></a>数据集</h3><p>首先到证书–本地用户&#x2F;本地组创建需要使用的用户  并按照权限和访问内容分组<br>在数据集选中数据集后(或创建时)  权限选项中可编辑<br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-14.png" alt="TrueNAS_Scale从入门到入土-14"><br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-15.png" alt="TrueNAS_Scale从入门到入土-15"></p><h3 id="ACL"><a href="#ACL" class="headerlink" title="ACL"></a>ACL</h3><p>在创建共享后，可根据需求细化权限分配，并保存ACL预设以供下次直接调用<br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-16.png" alt="TrueNAS_Scale从入门到入土-16"></p><h2 id="文件快照"><a href="#文件快照" class="headerlink" title="文件快照"></a>文件快照</h2><p>添加任务<br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-17.png" alt="TrueNAS_Scale从入门到入土-17"><br>设置需要保存快照的数据集，频率和时间，以及快照留存时长<br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-18.png" alt="TrueNAS_Scale从入门到入土-18"><br>快照计划也可以自定义<br><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-19.png" alt="TrueNAS_Scale从入门到入土-19"></p><h1 id="Docker-amp-虚拟机"><a href="#Docker-amp-虚拟机" class="headerlink" title="Docker &amp; 虚拟机"></a>Docker &amp; 虚拟机</h1><p>摆烂不想写） 建议参考司波图视频，讲的很详细<br>后续会写一些自己的实际应用案例（如Jellyfin 等家庭影音、traefik反向代理和ACME证书、alist、 lidarr、 heimdall…….</p><h1 id="扩展：社区Docker软件源"><a href="#扩展：社区Docker软件源" class="headerlink" title="扩展：社区Docker软件源"></a>扩展：社区Docker软件源</h1><ul><li>TrueCharts</li></ul><p>在应用–管理目录–添加目录处输入   </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/truecharts/catalog </span><br></pre></td></tr></table></figure><p><img src="/2023/08/10/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F/TrueNAS_Scale%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E5%85%A5%E5%9C%9F-20.png" alt="TrueNAS_Scale从入门到入土-20"><br>TrueCharts各个应用都有官方文档</p><ul><li>由于国内访问github速度较慢。可自行使用⬛⬛⬛</li></ul>]]></content>
    
    
    <summary type="html">TrueNAS</summary>
    
    
    
    <category term="Site01" scheme="https://blog.ahao.space/categories/Site01/"/>
    
    
    <category term="学习" scheme="https://blog.ahao.space/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="折腾" scheme="https://blog.ahao.space/tags/%E6%8A%98%E8%85%BE/"/>
    
    <category term="家庭数据中心搭建" scheme="https://blog.ahao.space/tags/%E5%AE%B6%E5%BA%AD%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%BF%83%E6%90%AD%E5%BB%BA/"/>
    
  </entry>
  
  <entry>
    <title>Computer Science -- 基础知识库</title>
    <link href="https://blog.ahao.space/2023/04/12/Computer_%20Science%20--%20%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%BA%93/"/>
    <id>https://blog.ahao.space/2023/04/12/Computer_%20Science%20--%20%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E5%BA%93/</id>
    <published>2023-04-12T09:16:16.000Z</published>
    <updated>2024-04-12T12:58:50.082Z</updated>
    
    <content type="html"><![CDATA[<h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><blockquote><p>编撰本知识库旨在更好地为计算机专业的学生提供帮助，<br>并促进计算机科学知识的普及。</p></blockquote><h2 id="计算机科学自学指南👍"><a href="#计算机科学自学指南👍" class="headerlink" title="计算机科学自学指南👍"></a>计算机科学自学指南👍</h2><ul><li>全面且实用<br><a href="https://csdiy.wiki/">https://csdiy.wiki/</a><br><a href="https://github.com/PKUFlyingPig/cs-self-learning">https://github.com/PKUFlyingPig/cs-self-learning</a></li></ul><h2 id="电脑组装（基础硬件科普）"><a href="#电脑组装（基础硬件科普）" class="headerlink" title="电脑组装（基础硬件科普）"></a>电脑组装（基础硬件科普）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&quot;position: relative; width: 100%; height: 0; padding-bottom: 75%;&quot;&gt;&lt;iframe src=&quot;//player.bilibili.com/player.html?aid=818609247&amp;bvid=BV1BG4y137mG&amp;cid=918273402&amp;p=1&quot; scrolling=&quot;no&quot; border=&quot;0&quot; frameborder=&quot;no&quot; framespacing=&quot;0&quot; allowfullscreen=&quot;true&quot;&gt; &lt;/iframe&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>【硬件茶谈-装机教程】 <a href="https://www.bilibili.com/video/BV1BG4y137mG">https://www.bilibili.com/video/BV1BG4y137mG</a></p><p> <a href="https://www.bilibili.com/video/BV1EW411u7th">Crash Course: Computer Science</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;目的&quot;&gt;&lt;a href=&quot;#目的&quot; class=&quot;headerlink&quot; title=&quot;目的&quot;&gt;&lt;/a&gt;目的&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;编撰本知识库旨在更好地为计算机专业的学生提供帮助，&lt;br&gt;并促进计算机科学知识的普及。&lt;/p&gt;
&lt;/blockqu</summary>
      
    
    
    
    
    <category term="学习" scheme="https://blog.ahao.space/tags/%E5%AD%A6%E4%B9%A0/"/>
    
  </entry>
  
  <entry>
    <title>在ESXi中部署OPNsense开源防火墙</title>
    <link href="https://blog.ahao.space/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/"/>
    <id>https://blog.ahao.space/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/</id>
    <published>2023-04-11T13:42:40.000Z</published>
    <updated>2024-04-12T08:59:41.552Z</updated>
    
    <content type="html"><![CDATA[<h1 id="官方文档参考："><a href="#官方文档参考：" class="headerlink" title="官方文档参考："></a>官方文档参考：</h1><p><a href="https://docs.opnsense.org/manual/virtuals.html">OPNsense官方的 Virtual &amp; Cloud based Installation  指引</a><br><a href="https://docs.opnsense.org/manual/install.html">OPNsense官方的 详细安装指引</a>   </p><h1 id="环境准备："><a href="#环境准备：" class="headerlink" title="环境准备："></a>环境准备：</h1><p>ESXi安装和基本配置可参考视频<a href="https://www.bilibili.com/video/BV1k64y197T1/?spm_id_from=333.337.search-card.all.click">（B 站 科技宅小明） 内卷的路由器！ESXi iKuai openWRT USB网卡2.5Gbps</a></p><ul><li>本次演示使用的是ESXi 8.0版本，故界面有所不同（同学人说界面更modern了  我倒觉得没那么好看了)</li></ul><p>下载OPNsense  iso镜像，如图<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-0.png" alt="在ESXi中部署OPNsense开源防火墙-0"><br>文件解压得到：<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-1.png" alt="在ESXi中部署OPNsense开源防火墙-1"></p><h1 id="创建虚拟机"><a href="#创建虚拟机" class="headerlink" title="创建虚拟机"></a>创建虚拟机</h1><p>新建虚拟机，设置操作系统系列为其他，版本为FreeBSD 13（64位）<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-2.png" alt="在ESXi中部署OPNsense开源防火墙-2"><br>下一步，选择opnsense安装的磁盘<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-3.png" alt="在ESXi中部署OPNsense开源防火墙-3"><br>下一步设置配置：<br>我分配了2核cpu，2G内存(预留2G)，磁盘20G精简置备，单独分一个虚拟交换机OPNsense LAN(可直接使用默认的VM Network)，直通了一个网卡<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-4.png" alt="在ESXi中部署OPNsense开源防火墙-4"><br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-5.png" alt="在ESXi中部署OPNsense开源防火墙-5"></p><ul><li>需要考虑后续连接web后台管理，可选择多直通一个物理网卡作为LAN口或者使用默认的VM network并在安装完成后配置LAN口IP在你的网段内</li></ul><p>选择CD&#x2F;DVD控制器，左上角按钮上传刚才下载的iso文件<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-6.png" alt="在ESXi中部署OPNsense开源防火墙-6"><br>上传完成后下一步，确认无误后点击完成<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-7.png" alt="在ESXi中部署OPNsense开源防火墙-7"></p><h1 id="安装系统"><a href="#安装系统" class="headerlink" title="安装系统"></a>安装系统</h1><p>启动虚拟机<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-8.png" alt="在ESXi中部署OPNsense开源防火墙-8"></p><h2 id="可能出现需要选择网卡："><a href="#可能出现需要选择网卡：" class="headerlink" title="可能出现需要选择网卡："></a>可能出现需要选择网卡：</h2><p>开机时不按回车默认自动识别并设置WAN 和 LAN，<br>如出现，可重启并在启动过程中不按回车<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-9.png" alt="在ESXi中部署OPNsense开源防火墙-9"><br>如自动配置错误，则需要根据提示手动配置</p><h2 id="启动完直接来到登录界面"><a href="#启动完直接来到登录界面" class="headerlink" title="启动完直接来到登录界面"></a>启动完直接来到登录界面</h2><p>启动后如只显示LAN（有一个网卡无法识别），可点击编辑查看配置是否有误 或配置没保存<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-10.png" alt="在ESXi中部署OPNsense开源防火墙-10"><br>安装需要登录默认账号installer  密码opnsense<br>登录后会见到选择界面，第一个选择是键盘布局，默认即可（直接回车下一步）<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-11.png" alt="在ESXi中部署OPNsense开源防火墙-11"><br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-12.png" alt="在ESXi中部署OPNsense开源防火墙-12"></p><h3 id="使用UFS"><a href="#使用UFS" class="headerlink" title="使用UFS"></a>使用UFS</h3><p>选择磁盘格式，一样保持默认，回车下一项<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-13.png" alt="在ESXi中部署OPNsense开源防火墙-13"><br>然后方向⬇选择前面创建的20G虚拟磁盘、回车下一步<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-14.png" alt="在ESXi中部署OPNsense开源防火墙-14"><br>方向键⬅选择yes，按回车提交   一般可以直接安装，如报错<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-15.png" alt="在ESXi中部署OPNsense开源防火墙-15"></p><h3 id="如失败可选择ZFS"><a href="#如失败可选择ZFS" class="headerlink" title="如失败可选择ZFS"></a>如失败可选择ZFS</h3><p>可选择restart ，并在第一步选择zfs：<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-16.png" alt="在ESXi中部署OPNsense开源防火墙-16"><br>在下一步中保持默认回车（除非多盘组阵列）<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-17.png" alt="在ESXi中部署OPNsense开源防火墙-17"><br>在选择磁盘这一步中需要按下空格选择磁盘，当看到【*】时说明已选择，回车下一步<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-18.png" alt="在ESXi中部署OPNsense开源防火墙-18"><br>选择YES提交，然后可以看到安装进度条<br>安装完成后会跳转到root（最高权限账户）密码设置，按回车开始设置<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-19.png" alt="在ESXi中部署OPNsense开源防火墙-19"><br>输入两遍密码后会回到该菜单，选择下面的完成安装并重启系统<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-20.png" alt="在ESXi中部署OPNsense开源防火墙-20"><br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-21.png" alt="在ESXi中部署OPNsense开源防火墙-21"><br>重启后使用root在控制台登录成功，安装完成<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-22.png" alt="在ESXi中部署OPNsense开源防火墙-22"><br>安装成功，建议关机并拍个快照<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-23.png" alt="在ESXi中部署OPNsense开源防火墙-23"><br>后续可以直接还原状态<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-24.png" alt="在ESXi中部署OPNsense开源防火墙-24"></p><h1 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h1><p>选择语言简体中文，按需配置dns<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-25.png" alt="在ESXi中部署OPNsense开源防火墙-25"><br>选择时区为香港<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-26.png" alt="在ESXi中部署OPNsense开源防火墙-26"><br>如已修改光猫为桥接模式且需要使用防火墙拨号：在这一步设置连接方式pppoe并输入运营商提供的上网账号，<br>否则保持默认dhcp即可<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-27.png" alt="在ESXi中部署OPNsense开源防火墙-27"><br>设置ip为你的网段内，（注意不要与网关冲突）<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-28.png" alt="在ESXi中部署OPNsense开源防火墙-28"><br>后续按需配置，完成后会重定向到主页面<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-29.png" alt="在ESXi中部署OPNsense开源防火墙-29"><br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-30.png" alt="在ESXi中部署OPNsense开源防火墙-30"></p><h2 id="PPPOE接口"><a href="#PPPOE接口" class="headerlink" title="PPPOE接口"></a>PPPOE接口</h2><p>如遇到WAN口一直显示down，可查看接口分配看下pppoe是否分配错误，根据mac改回对应的网卡即可正常拨号<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-31.png" alt="在ESXi中部署OPNsense开源防火墙-31"></p><h2 id="配置-IPv6"><a href="#配置-IPv6" class="headerlink" title="配置 IPv6"></a>配置 IPv6</h2><p> 在 接口 -&gt; [WAN] 中，配置：<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-32.png" alt="在ESXi中部署OPNsense开源防火墙-32"><br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-33.png" alt="在ESXi中部署OPNsense开源防火墙-33"><br>配置完成后如支持ipv6可在接口  -&gt; 概况看到分配的地址<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-34.png" alt="在ESXi中部署OPNsense开源防火墙-34"><br>配置完成后来到接口 -&gt;LAN，设置ipv6配置类型为跟踪接口<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-35.png" alt="在ESXi中部署OPNsense开源防火墙-35"><br>并在同一页面最下面找到跟踪ipv6接口，选择WAN口<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-36.png" alt="在ESXi中部署OPNsense开源防火墙-36"><br>（记得每次更改完设置后都到回到页面顶端右上角应用更改<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-37.png" alt="在ESXi中部署OPNsense开源防火墙-37"></p><p>后续配置了加密dns分流 自动防dns污染，实现支持深度数据包入侵检测<br>然后下个游戏发现我的千兆下行变成了。。。<br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-38.png" alt="在ESXi中部署OPNsense开源防火墙-38"><br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-39.png" alt="在ESXi中部署OPNsense开源防火墙-39"><br><img src="/2023/04/11/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9C%A8ESXi%E4%B8%AD%E9%83%A8%E7%BD%B2OPNsense%E5%BC%80%E6%BA%90%E9%98%B2%E7%81%AB%E5%A2%99-40.png" alt="在ESXi中部署OPNsense开源防火墙-40"><br>变成了更为安全的五百兆下行！（确信）</p><p>—–截至发稿时间，opnsense已备注好信息封存，期待升级硬件重新启用（也可能直接上成品的机架式防火墙了。。）</p>]]></content>
    
    
    <summary type="html">ESXi虚拟机安装，OPNsense基础配置</summary>
    
    
    
    <category term="Site01" scheme="https://blog.ahao.space/categories/Site01/"/>
    
    
    <category term="学习" scheme="https://blog.ahao.space/tags/%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="折腾" scheme="https://blog.ahao.space/tags/%E6%8A%98%E8%85%BE/"/>
    
    <category term="家庭数据中心搭建" scheme="https://blog.ahao.space/tags/%E5%AE%B6%E5%BA%AD%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%BF%83%E6%90%AD%E5%BB%BA/"/>
    
  </entry>
  
</feed>
